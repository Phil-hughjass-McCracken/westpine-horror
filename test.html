<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Westpine Night — 2.0</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    background: #0a0a0f;
    color: #e6e6f0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
  }

  #ui {
    position: fixed;
    inset: 0 0 auto 0;
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 10px 14px;
    background: linear-gradient(180deg, rgba(10,10,15,.9), rgba(10,10,15,.25));
    backdrop-filter: blur(4px);
    z-index: 10;
  }

  .pill {
    padding: 4px 10px;
    border-radius: 14px;
    background: #1b1b25;
    border: 1px solid #2b2b38;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    font-size: 14px;
  }

  .right { margin-left: auto; opacity: .95; }
  .inv { display: flex; gap: 8px; align-items: center; }

  #game { display: block; margin: 0 auto; image-rendering: pixelated; }

  #overlay {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,.8);
    z-index: 20;
  }

  #overlay .card {
    background: #121219;
    border: 1px solid #2b2b38;
    border-radius: 16px;
    padding: 20px;
    width: min(680px, 92vw);
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,.6);
  }

  #overlay h1 { margin:0 0 8px; font-size:28px; }
  #overlay p { margin:8px 0 16px; line-height:1.5; }

  #overlay button {
    background: #2b2bff;
    border: 0;
    color: white;
    padding: 10px 16px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
  }

  #overlay button.secondary {
    background: #1b1b25;
    border: 1px solid #2b2b38;
    margin-left: 8px;
  }

  #alert {
    position: fixed;
    right: 12px;
    bottom: 12px;
    background: #3a0d0d;
    color: #ffb3b3;
    padding: 8px 12px;
    border: 1px solid #5c1717;
    border-radius: 10px;
    display: none;
    font-weight: 700;
    z-index: 15;
  }
</style>
</head>
<body>
  <div id="ui">
    <div class="pill">WASD/Arrows: Move</div>
    <div class="pill">Shift: Sprint (noise!)</div>
    <div class="pill">F: Flashlight</div>
    <div class="pill">E: Interact/Hide/Hack</div>
    <div class="pill right inv">
      Keys: <span id="keys">0</span>/4 · Stamina: <span id="stamina">100</span>% · Hidden: <span id="hidden">No</span> · Cams: <span id="cams">Online</span>
    </div>
  </div>

  <canvas id="game" width="960" height="576"></canvas>

  <div id="overlay">
    <div class="card">
      <h1 id="title">Westpine Night 2.0</h1>
      <p id="message">
        New: bigger scrolling map, flickering lights, camera terminals, inventory HUD, enterable classrooms, hearing & fake-outs<br/>
        Collect <b>4 keys</b>, avoid Mr. Johnson, hide in <b>lockers</b>, hack <b>camera terminals</b>, and get to the Principal's Office door.
      </p>
      <div>
        <button id="play">Play</button>
        <button id="retry" class="secondary" style="display:none">Retry</button>
      </div>
    </div>
  </div>

  <div id="alert">ALERT: Camera spotted you!</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  const uiKeys = document.getElementById('keys');
  const uiStam = document.getElementById('stamina');
  const uiHidden = document.getElementById('hidden');
  const uiCams = document.getElementById('cams');
  const overlay = document.getElementById('overlay');
  const titleEl = document.getElementById('title');
  const msgEl = document.getElementById('message');
  const playBtn = document.getElementById('play');
  const retryBtn = document.getElementById('retry');
  const alertEl = document.getElementById('alert');

  const TILE = 32;

  const MAP = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,2,0,0,0,0,0,0,1,0,5,5,0,0,0,0,1,0,0,0,0,1,0,0,0,4,0,0,0,0,1,0,0,0,0,0,6,0,0,1],
    [1,0,0,1,1,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,0,1,0,1,0,0,0,1,1,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,1,1,0,5,0,0,0,1,1,0,0,5,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,5,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,5,1,0,0,1],
    [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1],
    [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,5,0,0,0,0,0,1,0,0,0,0,5,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,6,1,0,0,1],
    [1,0,0,1,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,5,1,0,0,1],
    [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,1,1,0,0,0,1,0,1,1,0,0,1,0,7,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,5,1,0,0,1],
    [1,0,0,1,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,4,1,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,5,1,0,0,1],
    [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,1,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
    [1,0,0,1,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,1,1,0,0,0,1,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1],
    [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,5,1,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
  ];

  let player = {x:64, y:64, vx:0, vy:0, speed:2, hidden:false, stamina:100};
  let keys = [];
  let heldKeys = 0;
  let camsOnline = true;
  let camAlertTimer = 0;

  let input = {up:false,down:false,left:false,right:false,sprint:false,interact:false};

  function dist(a,b){ return Math.hypot(a.x-b.x,a.y-b.y); }
  function angle(a,b){ return Math.atan2(b.y-a.y,b.x-a.x); }

  // generate keys positions
  function spawnKeys(){
    keys = [];
    for(let y=0;y<MAP.length;y++){
      for(let x=0;x<MAP[0].length;x++){
        if(MAP[y][x]===4) keys.push({x:x*TILE+16, y:y*TILE+16, taken:false});
      }
    }
  }

  // enemy patrol + fakeout
  let enemy = {
    x:600, y:200, speed:1.5, alert:false, target:null,
    patrol:[{x:600,y:200},{x:800,y:200},{x:800,y:400},{x:600,y:400}],
    patrolIndex:0,
    fakeoutTimer:0, cooldown:0
  };

  function updateEnemy(){
    // simple patrol
    if(!enemy.alert && enemy.fakeoutTimer<=0){
      const wp = enemy.patrol[enemy.patrolIndex];
      let a = angle(enemy, wp);
      enemy.x += Math.cos(a)*enemy.speed;
      enemy.y += Math.sin(a)*enemy.speed;
      if(dist(enemy, wp)<16) enemy.patrolIndex=(enemy.patrolIndex+1)%enemy.patrol.length;
    }

    // alert chasing
    if(enemy.alert){
      const a = angle(enemy, enemy.target);
      enemy.x += Math.cos(a)*enemy.speed*1.2;
      enemy.y += Math.sin(a)*enemy.speed*1.2;
      enemy.cooldown--;
      if(enemy.cooldown<=0) enemy.alert=false;
    }

    // fakeout movement
    if(enemy.fakeoutTimer>0){
      enemy.fakeoutTimer--;
      const wp = enemy.patrol[enemy.patrolIndex];
      const a = angle(enemy, wp);
      enemy.x += Math.cos(a)*enemy.speed;
      enemy.y += Math.sin(a)*enemy.speed;
      if(dist(enemy, wp)<14) enemy.fakeoutTimer=0;
    }

    // camera detection
    if(camAlertTimer>0){
      camAlertTimer--;
      if(camAlertTimer<=0) alertEl.style.display='none';
    }
  }

  function updatePlayer(){
    let spd = player.speed;
    if(input.sprint && player.stamina>0){
      spd *= 1.5; player.stamina-=0.5;
    } else if(player.stamina<100){
      player.stamina+=0.25;
    }

    player.vx=0; player.vy=0;
    if(input.up) player.vy=-spd;
    if(input.down) player.vy=spd;
    if(input.left) player.vx=-spd;
    if(input.right) player.vx=spd;

    // simple collision
    let nx=player.x+player.vx, ny=player.y+player.vy;
    if(!tileAt(nx,ny)) { player.x=nx; player.y=ny; }

    // collect keys
    for(const k of keys){
      if(!k.taken && dist(player,k)<18){
        k.taken=true; heldKeys++; uiKeys.textContent=heldKeys;
      }
    }

    // hidden
    player.hidden=input.interact?true:false;
    uiHidden.textContent=player.hidden?'Yes':'No';
    uiStam.textContent=Math.round(player.stamina);
  }

  function tileAt(x,y){
    const tx=Math.floor(x/TILE), ty=Math.floor(y/TILE);
    if(ty<0 || ty>=MAP.length || tx<0 || tx>=MAP[0].length) return 1;
    return MAP[ty][tx]===1;
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    // draw map
    for(let y=0;y<MAP.length;y++){
      for(let x=0;x<MAP[0].length;x++){
        switch(MAP[y][x]){
          case 1: ctx.fillStyle='#222'; break; // wall
          case 4: ctx.fillStyle='#ff0'; break; // key
          case 5: ctx.fillStyle='#555'; break; // floor/locker
          case 6: ctx.fillStyle='#0ff'; break; // camera
          case 7: ctx.fillStyle='#f00'; break; // door
          default: ctx.fillStyle='#111';
        }
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      }
    }

    // keys
    for(const k of keys){
      if(!k.taken){ ctx.fillStyle='#ff0'; ctx.beginPath(); ctx.arc(k.x,k.y,8,0,Math.PI*2); ctx.fill(); }
    }

    // player
    ctx.fillStyle='#0f0';
    ctx.beginPath(); ctx.arc(player.x,player.y,10,0,Math.PI*2); ctx.fill();

    // enemy
    ctx.fillStyle=enemy.alert?'#f00':'#f80';
    ctx.beginPath(); ctx.arc(enemy.x,enemy.y,12,0,Math.PI*2); ctx.fill();
  }

  function gameLoop(){
    updatePlayer();
    updateEnemy();
    draw();
    requestAnimationFrame(gameLoop);
  }

  // input
  window.addEventListener('keydown', e=>{
    switch(e.code){
      case 'ArrowUp': case 'KeyW': input.up=true; break;
      case 'ArrowDown': case 'KeyS': input.down=true; break;
      case 'ArrowLeft': case 'KeyA': input.left=true; break;
      case 'ArrowRight': case 'KeyD': input.right=true; break;
      case 'ShiftLeft': input.sprint=true; break;
      case 'KeyE': input.interact=true; break;
    }
  });
  window.addEventListener('keyup', e=>{
    switch(e.code){
      case 'ArrowUp': case 'KeyW': input.up=false; break;
      case 'ArrowDown': case 'KeyS': input.down=false; break;
      case 'ArrowLeft': case 'KeyA': input.left=false; break;
      case 'ArrowRight': case 'KeyD': input.right=false; break;
      case 'ShiftLeft': input.sprint=false; break;
      case 'KeyE': input.interact=false; break;
    }
  });

  // start game
  playBtn.onclick = ()=>{
    overlay.style.display='none';
    spawnKeys();
    gameLoop();
  };
})();
</script>
</body>
</html>
